---
import ekouLogo from '../assets/ekouLogo-v1.svg'
import ThemeController from './ThemeController'
import { ChevronDown, Languages } from 'lucide-react'
import ModalLanguage from './ModalLanguage.astro'
import es from '../i18n/es.json'
import en from '../i18n/en.json'

const locale = Astro.currentLocale
const t = locale === 'es' ? es : en

const navLinks = [
  { href: '#main', label: t.navbar.home },
  { href: '#quienes-somos', label: t.navbar.about },
  { href: '#como-te-ayudamos', label: t.navbar.help },
  { href: '#casos-de-exito', label: t.navbar.success },
  { href: '#blog', label: t.navbar.blog },
  { href: '#hablemos', label: t.navbar.contact, highlight: true },
]
---

<nav
  class="w-[94%] h-14 m-auto bg-(--surface-secundary)/80 backdrop-blur-md text-(--text-primary) flex justify-between items-center px-6 rounded-3xl fixed z-50 top-2 left-[3%] border border-(--color-border)"
>
  <img src={ekouLogo.src} alt="logo de ekou" />
  <ul class="flex flex-1 justify-center items-center gap-8">
    {
      navLinks.map(({ href, label, highlight }) => (
        <li>
          <a
            href={href}
            class={`cursor-pointer text-sm transition-transform duration-100 ease-in-out hover:text-(--color-primary)
               ${highlight && 'text-(--color-primary) hover:text-(--text-primary)'}`}
          >
            {label}
          </a>
        </li>
      ))
    }
  </ul>
  <div class="relative flex gap-5 text-(--color-primary)">
    <ThemeController client:load />
    <button id="language-btn" class="flex justify-center items-center cursor-pointer">
      <Languages />
      <ChevronDown id="arrow" className="w-5 h-5 transition-transform duration-200" />
    </button>

    <section id="language-modal" class="lang-modal fixed right-2 top-16">
      <ModalLanguage />
    </section>
  </div>
</nav>

<script>
  const btn = document.getElementById('language-btn')
  const modal = document.getElementById('language-modal')
  const arrow = document.getElementById('arrow')

  if (btn && modal) {
    btn.addEventListener('click', (event) => {
      event.stopPropagation()
      const isOpen = modal.classList.toggle('open')
      arrow?.classList.toggle('rotate-180', isOpen)
    })

    modal.addEventListener('click', (event) => event.stopPropagation())

    document.addEventListener('click', () => {
      modal.classList.remove('open')
      arrow?.classList.remove('rotate-180')
    })
  }
</script>

<style>
  .lang-modal {
    opacity: 0;
    transform: translateY(-8px);
    pointer-events: none;
    transition:
      opacity 200ms ease,
      transform 200ms ease;
  }

  .lang-modal.open {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
</style>
