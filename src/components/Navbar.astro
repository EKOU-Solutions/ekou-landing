---
import ekouLogo from '../assets/ekouLogo-v1.svg'
import ThemeController from './ThemeController.astro'
import { ChevronDown, Languages, Menu } from 'lucide-react'
import ModalLanguage from './ModalLanguage.astro'
import { getLangFromUrl, useTranslations } from '../i18n/utils/config'
const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang)
const navbar = t('navbar')

const navLinks = [
  { href: '#main', label: navbar.home },
  { href: '#quienes-somos', label: navbar.about },
  { href: '#como-te-ayudamos', label: navbar.help },
  { href: '#servicios', label: navbar.services },
  { href: '#casos-de-exito', label: navbar.success },
  { href: '#blog', label: navbar.blog },
  { href: '#hablemos', label: navbar.contact },
]
---

<nav
  data-site-header
  class="w-[94%] h-14 m-auto bg-(--surface-secundary)/80 backdrop-blur-md text-(--text-primary) flex justify-between items-center px-6 rounded-3xl fixed z-50 top-2 left-[3%] border border-(--color-border)"
>
  <img src={ekouLogo.src} alt="logo de ekou" />
  <ul class="hidden lg:flex flex-1 justify-center items-center gap-8">
    {
      navLinks.map(({ href, label }) => (
        <li>
          <a
            href={href}
            data-section-link={href}
            class="cursor-pointer text-sm transition-transform duration-100 ease-in-out hover:text-(--color-primary)"
          >
            {label}
          </a>
        </li>
      ))
    }
  </ul>
  <div class="relative flex items-center gap-5 text-(--color-primary)">
    <ThemeController />
    <button id="language-btn" class="flex justify-center items-center cursor-pointer">
      <Languages />
      <ChevronDown id="arrow" className="w-5 h-5 transition-transform duration-200" />
    </button>
    <!--menu hamburguesa -->
    <button class="lg:hidden cursor-pointer" aria-label="Open menu">
      <Menu />
    </button>

    <section id="language-modal" class="lang-modal fixed right-2 top-16">
      <ModalLanguage />
    </section>
  </div>
</nav>

<script>
  const btn = document.getElementById('language-btn')
  const modal = document.getElementById('language-modal')
  const arrow = document.getElementById('arrow')

  if (btn && modal) {
    btn.addEventListener('click', (event) => {
      event.stopPropagation()
      const isOpen = modal.classList.toggle('open')
      arrow?.classList.toggle('rotate-180', isOpen)
    })

    modal.addEventListener('click', (event) => event.stopPropagation())

    document.addEventListener('click', () => {
      modal.classList.remove('open')
      arrow?.classList.remove('rotate-180')
    })
  }
</script>

<style>
  .lang-modal {
    opacity: 0;
    transform: translateY(-8px);
    pointer-events: none;
    transition:
      opacity 200ms ease,
      transform 200ms ease;
  }

  .lang-modal.open {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }

  a.is-active {
    color: var(--color-primary);
  }

  a[data-section-link] {
    position: relative;
  }

  a[data-section-link]::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: -3px;
    height: 1.5px;
    border-radius: 20px;
    background: currentColor;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 220ms ease;
  }

  a[data-section-link].is-active::after {
    transform: scaleX(1);
  }
</style>
